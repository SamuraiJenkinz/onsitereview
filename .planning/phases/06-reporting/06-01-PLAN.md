# Phase 6: Reporting - HTML Reports with Coaching Recommendations

## Objective
Generate professional HTML reports with Jinja2 templates, Tailwind CSS styling, Plotly.js score gauges, and actionable coaching recommendations.

## Deliverables

### 1. Package Structure
```
src/tqrs/reports/
├── __init__.py         # Public exports
├── generator.py        # ReportGenerator class
└── templates/
    ├── individual.html # Single ticket report
    └── batch.html      # Batch summary report
```

### 2. Individual Ticket Report Features
- Header with ticket number, score, and performance band
- Score gauge visualization (Plotly.js)
- Executive summary (template, contact type, metadata)
- Detailed criterion-by-criterion breakdown
- Evidence quotes with reasoning
- Coaching recommendations per criterion
- Strengths and improvements summary
- Full ticket details section

### 3. Batch Summary Report Features
- Overall statistics (total, passed, failed, avg score)
- Performance band distribution chart
- Score distribution histogram
- Common issues breakdown
- Table of all tickets with scores
- Links to individual reports (optional)

### 4. Streamlit Integration
- Generate HTML button for individual tickets
- Download batch report button
- Preview in iframe or new tab

## Technical Design

### ReportGenerator Class
```python
class ReportGenerator:
    """Generate HTML reports from evaluation results."""

    def __init__(self, template_dir: Path | None = None):
        self.env = Environment(loader=...)

    def generate_individual_report(
        self,
        result: EvaluationResult,
        ticket: ServiceNowTicket,
    ) -> str:
        """Generate HTML for a single ticket evaluation."""

    def generate_batch_report(
        self,
        results: list[EvaluationResult],
        summary: BatchEvaluationSummary,
    ) -> str:
        """Generate HTML for batch summary."""

    def save_report(self, html: str, path: Path) -> None:
        """Save HTML to file."""
```

### Template Data Structure
```python
# For individual.html
{
    "ticket_number": "INC8924218",
    "template_name": "Incident Logging",
    "contact_type": "Phone",
    "category": "software",
    "subcategory": "reset_restart",
    "short_description": "...",
    "description": "...",
    "close_notes": "...",

    "total_score": 70,
    "max_score": 70,
    "percentage": 100.0,
    "band": "BLUE",
    "band_color": "#3B82F6",
    "passed": True,

    "criterion_scores": [
        {
            "name": "Correct Category",
            "score": 10,
            "max_points": 10,
            "percentage": 100.0,
            "evidence": "...",
            "reasoning": "...",
            "coaching": None,
        },
        ...
    ],

    "validation_status": "PASS",
    "validation_deduction": 0,
    "critical_process_status": "N/A",
    "critical_process_deduction": 0,

    "strengths": [...],
    "improvements": [...],

    "evaluated_at": "2025-12-26 10:30:00",
}
```

## Execution Plan

### Task 1: Create Package Structure
- Create `src/tqrs/reports/` directory
- Create `__init__.py` with exports
- Create `templates/` subdirectory

### Task 2: Build Individual Report Template
- Jinja2 template with Tailwind CSS CDN
- Plotly.js gauge chart integration
- Responsive design with sections for all data
- Color-coded scoring and status indicators

### Task 3: Build Batch Summary Template
- Statistics overview cards
- Plotly.js charts (histogram, pie)
- Sortable results table
- Export-friendly formatting

### Task 4: Create ReportGenerator Class
- Jinja2 environment setup
- Template rendering methods
- Helper functions for colors and formatting
- File saving utility

### Task 5: Streamlit Integration
- Add report generation buttons
- Download functionality for HTML files
- Optional preview capability

### Task 6: Testing
- Generate sample reports
- Validate HTML output
- Verify visualizations render correctly

## Dependencies
- jinja2 (already in pyproject.toml)
- No additional packages needed (Tailwind CSS and Plotly.js via CDN)

## Success Criteria
- Individual reports render correctly with all sections
- Batch reports show accurate statistics and charts
- HTML downloads work in Streamlit
- Reports are visually professional and consistent
